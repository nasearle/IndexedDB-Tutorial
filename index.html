<!doctype html>
<html>
<head>
	<script type="text/javascript" src =
	"http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<script type="text/javascript" src ="idb.js"></script>
</head>

<body>

<h2>Add Person</h2>
<input type="text" id="name" placeholder="Name"><br/>
<input type="email" id="email" placeholder="Email"><br/>
<input type="text" id="age" placeholder="Age"><br/>
<input type="text" id="animal" placeholder="Favorite Animal"><br/>
<button id="addPerson">Add Person</button>
<p/>

<script>
function idbOK() {
	return "indexedDB" in window;
}

$(document).ready(function() {
	if(!idbOK()) return;

	var dbPromise = idb.open('test-db7', 4, function(upgradeDb) {
	  switch(upgradeDb.oldVersion) {
	    case 0:
	      upgradeDb.createObjectStore('people', { keyPath: "email" });
	    case 1:
	      var peopleStore = upgradeDb.transaction.objectStore('people');
	      peopleStore.createIndex('name', 'name');
			case 2:
				var peopleStore = upgradeDb.transaction.objectStore('people');
				peopleStore.createIndex('animal', 'favoriteAnimal');
			case 3:
				peopleStore = upgradeDb.transaction.objectStore('people');
				peopleStore.createIndex('age', 'age');
	  }
	});

	$("#addPerson").on("click", addPerson);
});

function addPerson() {
	var name = $("#name").val();
	var email = $("#email").val();
	var age = $("#age").val();
	var animal = $("#animal").val();
	console.log("About to add "+name+"/"+email);

	dbPromise.then(function(db) {
		var tx = db.transaction(["people"], "readwrite");
		var store = tx.objectStore("people");
		var person = {
			name:name,
			email:email,
			age:age,
			favoriteAnimal:animal
			created:new Date().getTime()
		}
		store.add(person);
		return tx.complete;
	}).then(function() {
		console.log("added person to the people os!");
	});
}
</script>
</body>
</html>
