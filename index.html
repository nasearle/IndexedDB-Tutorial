<!doctype html>
<html>
<head>
	<script type="text/javascript" src =
	"http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<script type="text/javascript" src="idb.js"></script>
</head>

<body>

<h2>Delete Person</h2>
<input type="text" id="email"> <button id="deletePerson">Delete Person</button>

<script>
function idbOK() {
	return "indexedDB" in window;
}

$(document).ready(function() {

	//No support? Go in the corner and pout.
	if(!idbOK()) return;
	dbPromise = idb.open("test-db5", 1, function(upgradeDB) {
		if (!upgradeDB.objectStoreNames.contains("people")) {
			var peopleOS = upgradeDB.createObjectStore("people", {keyPath: "email"});
		}
		if (!upgradeDB.objectStoreNames.contains("notes")) {
			var notesOS = upgradeDB.createObjectStore("notes", {autoIncrement:true});
		}
	});

	//Start listening for button clicks
	$("#deletePerson").on("click", deletePerson);
});

function getPerson() {
	var key = $("#getemail").val();
	if(key === "") return;
	dbPromise.then(function(db) {
		var tx = db.transaction(["people"],"readonly");
		var store = tx.objectStore("people");
		return store.get(key);
	}).then(function(val) {
		console.dir(val);
		$("#name").val(val.name);
		$("#email").val(val.email);
		$("#created").val(val.created);
	});
}

function deletePerson(e) {
	var key = $("#email").val();
	if(key === "") return;
	dbPromise.then(function(db) {
		var tx = db.transaction(["people"],"readwrite");
		var store = tx.objectStore("people");
		store.delete(key);
		return tx.complete;
	}).then(function() {
		console.log("Person deleted");
	});
}
</script>
</body>
</html>
